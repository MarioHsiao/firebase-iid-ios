/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2015 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int __fastcall FIRInstanceIDWebSafeBase64(__int64 a1);
void *__fastcall FIRInstanceIDSecKeyBase64Encoding(void *a1);
void *__fastcall FIRInstanceIDSHA1(void *a1);
int __fastcall FIRInstanceIDSHA256(void *a1);
int __fastcall FIRInstanceIDConcatenateStrings(__int64 a1, __int64 a2, __int64 a3, __int64 a4, __int64 a5, __int64 a6, char a7);
int __fastcall FIRInstanceIDSignParams(__int64 a1, void *a2);
int __fastcall FIRInstanceIDSignData(__int64 a1, void *a2);
__int64 __fastcall FIRInstanceIDVerifyData(__int64 a1, void *a2, __int64 a3);
__int64 __fastcall FIRInstanceIDVerifyDataWithRSA(__int64 a1, void *a2, __int64 a3);
// int __fastcall CC_SHA1(_QWORD, _QWORD, _QWORD); weak
// int __fastcall CC_SHA256(_QWORD, _QWORD, _QWORD); weak
// int FIRInstanceIDSharedLogger(void); weak
// int __fastcall SecKeyGetBlockSize(_QWORD); weak
// int __fastcall SecKeyRawSign(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD); weak
// int __fastcall SecKeyRawVerify(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD); weak
// void __cdecl free(void *);
// void *__cdecl malloc(size_t);
// int __fastcall objc_autoreleaseReturnValue(_QWORD); weak
// void *objc_msgSend(void *, const char *, ...); idb
// int __fastcall objc_release(_QWORD); weak
// int __fastcall objc_retainAutorelease(_QWORD); weak
// int __fastcall objc_retainAutoreleasedReturnValue(_QWORD); weak

//-------------------------------------------------------------------------
// Data declarations

void *off_890 = &OBJC_CLASS___FIRInstanceIDStringEncoding; // weak
__int64 (__fastcall *paRfc4648base64w)() = &aRfc4648base64w; // weak
char a_[4] = "\n%@"; // weak
__CFString cfstr__ = { &__CFConstantStringClassReference, 1992LL, "\n%@", 3LL }; // weak
// extern _UNKNOWN OBJC_CLASS___FIRInstanceIDStringEncoding; weak
// extern _UNKNOWN __stack_chk_guard; weak
// extern int (__fastcall *objc_retain)(_QWORD); weak


//----- (0000000000000000) ----------------------------------------------------
int __fastcall FIRInstanceIDWebSafeBase64(__int64 a1)
{
  __int64 v1; // rax@1
  __int64 v2; // r15@1
  void *v3; // rax@1
  void *v4; // rax@1
  void *v5; // rbx@1
  void *v6; // r14@1
  __int64 v7; // rax@1
  __int64 v8; // r14@1

  LODWORD(v1) = objc_retain(a1);
  v2 = v1;
  v3 = objc_msgSend(&OBJC_CLASS___FIRInstanceIDStringEncoding, (const char *)paRfc4648base64w);
  LODWORD(v4) = objc_retainAutoreleasedReturnValue(v3);
  v5 = v4;
  objc_msgSend(v4, (const char *)*(&paRfc4648base64w + 1), 0LL);
  v6 = objc_msgSend(v5, (const char *)*(&paRfc4648base64w + 2), v2);
  objc_release(v2);
  LODWORD(v7) = objc_retainAutoreleasedReturnValue(v6);
  v8 = v7;
  objc_release(v5);
  return objc_autoreleaseReturnValue(v8);
}
// 890: using guessed type void *off_890;
// 998: using guessed type __int64 (__fastcall *paRfc4648base64w)();
// 37E0: using guessed type int __fastcall objc_autoreleaseReturnValue(_QWORD);
// 37F0: using guessed type int __fastcall objc_release(_QWORD);
// 37F8: using guessed type int (__fastcall *objc_retain)(_QWORD);
// 3808: using guessed type int __fastcall objc_retainAutoreleasedReturnValue(_QWORD);

//----- (000000000000008D) ----------------------------------------------------
void *__fastcall FIRInstanceIDSecKeyBase64Encoding(void *a1)
{
  return objc_msgSend(a1, (const char *)*(&paRfc4648base64w + 3), 1LL);
}
// 998: using guessed type __int64 (__fastcall *paRfc4648base64w)();

//----- (00000000000000A4) ----------------------------------------------------
void *__fastcall FIRInstanceIDSHA1(void *a1)
{
  const char *v1; // r14@1
  __int64 v2; // rax@1
  __int64 v3; // r15@1
  void *v4; // rax@1
  void *v5; // rbx@1
  void *result; // rax@1
  __int64 v7; // rcx@1
  char v8; // [sp+0h] [bp-40h]@1
  __int64 v9; // [sp+18h] [bp-28h]@1

  v9 = *__stack_chk_guard;
  v1 = (const char *)*(&paRfc4648base64w + 4);
  LODWORD(v2) = objc_retain(a1);
  v3 = v2;
  LODWORD(v1) = (unsigned __int64)objc_msgSend(a1, v1);
  LODWORD(v4) = objc_retainAutorelease(a1);
  v5 = objc_msgSend(v4, (const char *)*(&paRfc4648base64w + 5));
  objc_release(v3);
  CC_SHA1(v5, (unsigned int)v1, &v8);
  result = objc_msgSend(*(&off_890 + 1), (const char *)*(&paRfc4648base64w + 6), &v8, 20LL);
  v7 = *__stack_chk_guard;
  return result;
}
// 890: using guessed type void *off_890;
// 998: using guessed type __int64 (__fastcall *paRfc4648base64w)();
// 3770: using guessed type int __fastcall CC_SHA1(_QWORD, _QWORD, _QWORD);
// 37F0: using guessed type int __fastcall objc_release(_QWORD);
// 37F8: using guessed type int (__fastcall *objc_retain)(_QWORD);
// 3800: using guessed type int __fastcall objc_retainAutorelease(_QWORD);

//----- (0000000000000155) ----------------------------------------------------
int __fastcall FIRInstanceIDSHA256(void *a1)
{
  const char *v1; // r14@1
  __int64 v2; // rax@1
  __int64 v3; // r15@1
  void *v4; // rax@1
  void *v5; // rbx@1
  __int64 v6; // rax@1
  void *v7; // rax@2
  __int64 v8; // rax@2
  __int64 v9; // rdi@2
  __int64 v10; // rax@4
  char v12; // [sp+0h] [bp-50h]@1
  __int64 v13; // [sp+20h] [bp-30h]@1

  v13 = *__stack_chk_guard;
  v1 = (const char *)*(&paRfc4648base64w + 4);
  LODWORD(v2) = objc_retain(a1);
  v3 = v2;
  LODWORD(v1) = (unsigned __int64)objc_msgSend(a1, v1);
  LODWORD(v4) = objc_retainAutorelease(a1);
  v5 = objc_msgSend(v4, (const char *)*(&paRfc4648base64w + 5));
  objc_release(v3);
  LODWORD(v6) = CC_SHA256(v5, (unsigned int)v1, &v12);
  if ( v6 )
  {
    v7 = objc_msgSend(*(&off_890 + 1), (const char *)*(&paRfc4648base64w + 6), &v12, 32LL);
    LODWORD(v8) = objc_retainAutoreleasedReturnValue(v7);
    v9 = v8;
  }
  else
  {
    v9 = 0LL;
  }
  v10 = *__stack_chk_guard;
  if ( *__stack_chk_guard == v13 )
    LODWORD(v10) = objc_autoreleaseReturnValue(v9);
  return v10;
}
// 890: using guessed type void *off_890;
// 998: using guessed type __int64 (__fastcall *paRfc4648base64w)();
// 3778: using guessed type int __fastcall CC_SHA256(_QWORD, _QWORD, _QWORD);
// 37E0: using guessed type int __fastcall objc_autoreleaseReturnValue(_QWORD);
// 37F0: using guessed type int __fastcall objc_release(_QWORD);
// 37F8: using guessed type int (__fastcall *objc_retain)(_QWORD);
// 3800: using guessed type int __fastcall objc_retainAutorelease(_QWORD);
// 3808: using guessed type int __fastcall objc_retainAutoreleasedReturnValue(_QWORD);

//----- (0000000000000229) ----------------------------------------------------
int __fastcall FIRInstanceIDConcatenateStrings(__int64 a1, __int64 a2, __int64 a3, __int64 a4, __int64 a5, __int64 a6, char a7)
{
  __int64 v7; // rax@1
  __int64 v8; // r12@1
  void *v9; // rdi@2
  const char *v10; // rsi@2
  void *v11; // rax@2
  void *v12; // rax@2
  void *v13; // r15@2
  const char *v14; // r13@2
  __int64 i; // rbx@2
  char *v16; // rax@5
  __int64 v17; // rax@7
  __int64 v18; // r14@7
  __int64 v19; // rax@9
  void *v20; // rax@9
  void *v21; // rbx@9
  void *v22; // rbx@10
  __int64 v23; // rax@10
  char v25; // [sp+0h] [bp-110h]@1
  __int64 v26; // [sp+8h] [bp-108h]@1
  __int64 v27; // [sp+10h] [bp-100h]@1
  __int64 v28; // [sp+18h] [bp-F8h]@1
  __int64 v29; // [sp+20h] [bp-F0h]@1
  __int64 v30; // [sp+28h] [bp-E8h]@1
  __int64 v31; // [sp+B8h] [bp-58h]@2
  int v32; // [sp+C0h] [bp-50h]@1
  int v33; // [sp+C4h] [bp-4Ch]@1
  char *v34; // [sp+C8h] [bp-48h]@1
  char *v35; // [sp+D0h] [bp-40h]@1
  __int64 v36; // [sp+E0h] [bp-30h]@1

  v30 = a6;
  v29 = a5;
  v28 = a4;
  v27 = a3;
  v26 = a2;
  v36 = *__stack_chk_guard;
  LODWORD(v7) = ((int (*)(void))objc_retain)();
  v8 = v7;
  v35 = &v25;
  v34 = &a7;
  v33 = 48;
  v32 = 8;
  if ( v7 )
  {
    v9 = *(&off_890 + 2);
    v10 = (const char *)*(&paRfc4648base64w + 7);
    v31 = v7;
    v11 = objc_msgSend(v9, v10, v7);
    LODWORD(v12) = objc_retainAutoreleasedReturnValue(v11);
    v13 = v12;
    v14 = (const char *)*(&paRfc4648base64w + 8);
    for ( i = 0LL; ; i = v18 )
    {
      if ( (unsigned __int64)v32 > 0x28 )
      {
        v16 = v34;
        v34 += 8;
      }
      else
      {
        v16 = &v35[v32];
        v32 += 8;
      }
      LODWORD(v17) = objc_retain(*(_QWORD *)v16);
      v18 = v17;
      objc_release(i);
      if ( !v18 )
        break;
      objc_msgSend(v13, v14, &cfstr__, v18);
    }
    objc_release(0LL);
    v8 = v31;
  }
  else
  {
    LODWORD(v19) = FIRInstanceIDSharedLogger();
    LODWORD(v20) = objc_retainAutoreleasedReturnValue(v19);
    v21 = v20;
    v13 = 0LL;
    objc_msgSend(v20, (const char *)*(&paRfc4648base64w + 9), &a_[4], 11002LL, &cfstr__ + 1);
    objc_release(v21);
  }
  v22 = objc_msgSend(v13, (const char *)*(&paRfc4648base64w + 10));
  objc_release(v13);
  objc_release(v8);
  v23 = *__stack_chk_guard;
  if ( *__stack_chk_guard == v36 )
    LODWORD(v23) = objc_autoreleaseReturnValue(v22);
  return v23;
}
// 890: using guessed type void *off_890;
// 998: using guessed type __int64 (__fastcall *paRfc4648base64w)();
// AE0: using guessed type __CFString cfstr__;
// 3780: using guessed type int FIRInstanceIDSharedLogger(void);
// 37E0: using guessed type int __fastcall objc_autoreleaseReturnValue(_QWORD);
// 37F0: using guessed type int __fastcall objc_release(_QWORD);
// 37F8: using guessed type int (__fastcall *objc_retain)(_QWORD);
// 3808: using guessed type int __fastcall objc_retainAutoreleasedReturnValue(_QWORD);

//----- (00000000000003FB) ----------------------------------------------------
int __fastcall FIRInstanceIDSignParams(__int64 a1, void *a2)
{
  void *v2; // rax@1
  void *v3; // rax@1
  void *v4; // r14@1
  __int64 v5; // rax@1
  void *v6; // rax@1
  __int64 v7; // rbx@1
  __int64 v8; // rax@2
  __int64 v9; // rax@2
  __int64 v10; // r15@2

  v2 = objc_msgSend(a2, (const char *)*(&paRfc4648base64w + 11), 4LL);
  LODWORD(v3) = objc_retainAutoreleasedReturnValue(v2);
  v4 = v3;
  LODWORD(v5) = FIRInstanceIDSignData(a1, v3);
  LODWORD(v6) = objc_retainAutoreleasedReturnValue(v5);
  v7 = (__int64)v6;
  if ( objc_msgSend(v6, (const char *)*(&paRfc4648base64w + 4)) )
  {
    LODWORD(v8) = FIRInstanceIDWebSafeBase64(v7);
    LODWORD(v9) = objc_retainAutoreleasedReturnValue(v8);
    v10 = v9;
  }
  else
  {
    v10 = 0LL;
  }
  objc_release(v7);
  objc_release(v4);
  return objc_autoreleaseReturnValue(v10);
}
// 998: using guessed type __int64 (__fastcall *paRfc4648base64w)();
// 37E0: using guessed type int __fastcall objc_autoreleaseReturnValue(_QWORD);
// 37F0: using guessed type int __fastcall objc_release(_QWORD);
// 3808: using guessed type int __fastcall objc_retainAutoreleasedReturnValue(_QWORD);

//----- (0000000000000493) ----------------------------------------------------
int __fastcall FIRInstanceIDSignData(__int64 a1, void *a2)
{
  __int64 v2; // rax@1
  __int64 v3; // r15@1
  __int64 v4; // rax@1
  size_t v5; // rbx@1
  void *v6; // r13@1
  void *v7; // rax@1
  void *v8; // r15@1
  void *v9; // rax@1
  void *v10; // rax@1
  unsigned __int64 v11; // rbx@2
  signed __int64 v12; // r12@2
  unsigned __int64 v13; // r13@2
  unsigned __int64 v14; // rax@3
  int v15; // er14@5
  void *v16; // r14@6
  __int64 v17; // r15@6
  __int64 v18; // rax@7
  __int64 v19; // rbx@7
  __int64 v20; // rax@8
  void *v21; // rax@8
  void *v22; // r12@8
  char *v24; // [sp+10h] [bp-60h]@1
  unsigned __int64 v25; // [sp+18h] [bp-58h]@2
  const char *v26; // [sp+20h] [bp-50h]@2
  __int64 v27; // [sp+28h] [bp-48h]@1
  __int64 v28; // [sp+30h] [bp-40h]@1
  unsigned __int64 v29; // [sp+38h] [bp-38h]@1
  void *v30; // [sp+40h] [bp-30h]@1

  LODWORD(v2) = objc_retain(a2);
  v3 = v2;
  LODWORD(v4) = SecKeyGetBlockSize(a1);
  v5 = v4;
  v27 = v4;
  v6 = objc_msgSend(a2, (const char *)*(&paRfc4648base64w + 4));
  LODWORD(v7) = objc_retainAutorelease(a2);
  v24 = (char *)objc_msgSend(v7, (const char *)*(&paRfc4648base64w + 5));
  objc_release(v3);
  v28 = v5;
  v8 = malloc(v5);
  v9 = objc_msgSend(*(&off_890 + 1), (const char *)*(&paRfc4648base64w + 12));
  LODWORD(v10) = objc_retainAutoreleasedReturnValue(v9);
  v30 = v10;
  v29 = (unsigned __int64)v6;
  if ( v6 )
  {
    v26 = (const char *)*(&paRfc4648base64w + 13);
    v11 = ~v28;
    v25 = ~v29;
    v12 = -1LL;
    v13 = 0LL;
    while ( 1 )
    {
      v14 = v25;
      if ( v11 > v25 )
        v14 = v11;
      v15 = SecKeyRawSign(a1, 0LL, &v24[v13], v12 - v14, v8, &v27);
      if ( v15 )
        break;
      v16 = v8;
      v17 = v28;
      v13 += v28;
      objc_msgSend(v30, v26, v16);
      v12 -= v17;
      v11 -= v17;
      v8 = v16;
      if ( v29 <= v13 )
        goto LABEL_7;
    }
    LODWORD(v20) = FIRInstanceIDSharedLogger();
    LODWORD(v21) = objc_retainAutoreleasedReturnValue(v20);
    v22 = v21;
    v19 = 0LL;
    objc_msgSend(v21, (const char *)*(&paRfc4648base64w + 9), &a_[91], 11000LL, &cfstr__ + 2, (unsigned int)v15);
    objc_release(v22);
    free(v8);
  }
  else
  {
LABEL_7:
    free(v8);
    LODWORD(v18) = objc_retain(v30);
    v19 = v18;
  }
  objc_release(v30);
  return objc_autoreleaseReturnValue(v19);
}
// 890: using guessed type void *off_890;
// 998: using guessed type __int64 (__fastcall *paRfc4648base64w)();
// AE0: using guessed type __CFString cfstr__;
// 3780: using guessed type int FIRInstanceIDSharedLogger(void);
// 37A0: using guessed type int __fastcall SecKeyGetBlockSize(_QWORD);
// 37A8: using guessed type int __fastcall SecKeyRawSign(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 37E0: using guessed type int __fastcall objc_autoreleaseReturnValue(_QWORD);
// 37F0: using guessed type int __fastcall objc_release(_QWORD);
// 37F8: using guessed type int (__fastcall *objc_retain)(_QWORD);
// 3800: using guessed type int __fastcall objc_retainAutorelease(_QWORD);
// 3808: using guessed type int __fastcall objc_retainAutoreleasedReturnValue(_QWORD);

//----- (0000000000000645) ----------------------------------------------------
__int64 __fastcall FIRInstanceIDVerifyData(__int64 a1, void *a2, __int64 a3)
{
  __int64 v3; // r13@1
  __int64 v4; // rax@1
  __int64 v5; // ST08_8@1
  __int64 v6; // rax@1
  __int64 v7; // r13@1
  void *v8; // rax@1
  void *v9; // rax@1
  void *v10; // r14@1
  void *v11; // rbx@1
  __int64 v12; // rax@1
  __int64 v13; // r13@1
  void *v14; // rbx@1
  void *v15; // rax@1
  void *v16; // rbx@1
  __int64 v17; // ST00_8@1
  unsigned int v18; // er15@1

  v3 = a3;
  LODWORD(v4) = objc_retain(a2);
  v5 = v4;
  LODWORD(v6) = objc_retain(v3);
  v7 = v6;
  v8 = objc_msgSend(&OBJC_CLASS___FIRInstanceIDStringEncoding, (const char *)paRfc4648base64w, a1);
  LODWORD(v9) = objc_retainAutoreleasedReturnValue(v8);
  v10 = v9;
  objc_msgSend(v9, (const char *)*(&paRfc4648base64w + 1), 0LL);
  v11 = objc_msgSend(v10, (const char *)*(&paRfc4648base64w + 14), v7);
  objc_release(v7);
  LODWORD(v12) = objc_retainAutoreleasedReturnValue(v11);
  v13 = v12;
  v14 = objc_msgSend(a2, (const char *)*(&paRfc4648base64w + 11), 4LL);
  objc_release(v5);
  LODWORD(v15) = objc_retainAutoreleasedReturnValue(v14);
  v16 = v15;
  v18 = FIRInstanceIDVerifyDataWithRSA(v17, v15, v13);
  objc_release(v16);
  objc_release(v13);
  objc_release(v10);
  return v18;
}
// 890: using guessed type void *off_890;
// 998: using guessed type __int64 (__fastcall *paRfc4648base64w)();
// 37F0: using guessed type int __fastcall objc_release(_QWORD);
// 37F8: using guessed type int (__fastcall *objc_retain)(_QWORD);
// 3808: using guessed type int __fastcall objc_retainAutoreleasedReturnValue(_QWORD);

//----- (000000000000073C) ----------------------------------------------------
__int64 __fastcall FIRInstanceIDVerifyDataWithRSA(__int64 a1, void *a2, __int64 a3)
{
  __int64 v3; // r13@1
  __int64 v4; // rax@1
  __int64 v5; // ST20_8@1
  __int64 v6; // rax@1
  __int64 v7; // ST18_8@1
  __int64 v8; // rax@1
  __int64 v9; // r15@1
  void *v10; // r12@1
  void *v11; // rax@1
  int v12; // er14@1
  void *v13; // rax@1
  unsigned __int64 v14; // rbx@1
  signed __int64 v15; // r13@1
  unsigned __int64 v16; // r12@1
  unsigned __int64 v17; // rax@2
  char *v18; // rdx@5
  char *v19; // r8@5
  int v20; // eax@5
  __int64 v21; // rax@6
  void *v22; // rax@6
  void *v23; // rbx@6
  __int64 v25; // [sp+0h] [bp-50h]@1
  char *v26; // [sp+8h] [bp-48h]@1
  char *v27; // [sp+10h] [bp-40h]@1
  unsigned __int64 v28; // [sp+18h] [bp-38h]@1
  unsigned __int64 v29; // [sp+20h] [bp-30h]@1

  v3 = a3;
  LODWORD(v4) = objc_retain(a2);
  v5 = v4;
  LODWORD(v6) = objc_retain(v3);
  v7 = v6;
  LODWORD(v8) = SecKeyGetBlockSize(a1);
  v9 = v8;
  v10 = objc_msgSend(a2, (const char *)*(&paRfc4648base64w + 4), a1);
  LODWORD(v11) = objc_retainAutorelease(a2);
  v26 = (char *)objc_msgSend(v11, (const char *)*(&paRfc4648base64w + 5));
  v12 = (signed int)objc_release;
  objc_release(v5);
  LODWORD(v13) = objc_retainAutorelease(v3);
  v27 = (char *)objc_msgSend(v13, (const char *)*(&paRfc4648base64w + 5));
  objc_release(v7);
  v14 = ~v9;
  v28 = (unsigned __int64)v10;
  v29 = ~(unsigned __int64)v10;
  v15 = -1LL;
  v16 = 0LL;
  while ( 1 )
  {
    v17 = v29;
    if ( v14 > v29 )
      v17 = v14;
    LOBYTE(v12) = 1;
    if ( v28 <= v16 )
      break;
    v18 = &v26[v16];
    v19 = &v27[v16];
    v16 += v9;
    v20 = SecKeyRawVerify(v25, 0LL, v18, v15 - v17, v19, v9);
    v15 -= v9;
    v14 -= v9;
    if ( v20 )
    {
      LODWORD(v21) = FIRInstanceIDSharedLogger();
      LODWORD(v22) = objc_retainAutoreleasedReturnValue(v21);
      v23 = v22;
      v12 = 0;
      objc_msgSend(v22, (const char *)*(&paRfc4648base64w + 9), &a_[144], 11001LL, &cfstr__ + 3);
      objc_release(v23);
      return (unsigned int)v12;
    }
  }
  return (unsigned int)v12;
}
// 998: using guessed type __int64 (__fastcall *paRfc4648base64w)();
// AE0: using guessed type __CFString cfstr__;
// 3780: using guessed type int FIRInstanceIDSharedLogger(void);
// 37A0: using guessed type int __fastcall SecKeyGetBlockSize(_QWORD);
// 37B0: using guessed type int __fastcall SecKeyRawVerify(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 37F0: using guessed type int __fastcall objc_release(_QWORD);
// 37F8: using guessed type int (__fastcall *objc_retain)(_QWORD);
// 3800: using guessed type int __fastcall objc_retainAutorelease(_QWORD);
// 3808: using guessed type int __fastcall objc_retainAutoreleasedReturnValue(_QWORD);

// ALL OK, 9 function(s) have been successfully decompiled
